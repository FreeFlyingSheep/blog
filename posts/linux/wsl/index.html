<!doctype html><html lang=zh-cn dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>安装 WSL | FreeFlyingSheep 的小站</title><meta name=keywords content="WSL"><meta name=description content="根据微软官方文档 Windows Subsystem for Linux Installation Guide for Windows 10 整理。"><meta name=author content="FreeFlyingSheep"><link rel=canonical href=https://freeflyingsheep.github.io/posts/linux/wsl/><link crossorigin=anonymous href=/assets/css/stylesheet.min.35cd0f65a15cafa92372b8313deef5960aae04b90ad722f2bbf509eb0468137e.css integrity="sha256-Nc0PZaFcr6kjcrgxPe71lgquBLkK1yLyu/UJ6wRoE34=" rel="preload stylesheet" as=style><link rel=preload href=/avatar.png as=image><script defer crossorigin=anonymous src=/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://freeflyingsheep.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://freeflyingsheep.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://freeflyingsheep.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://freeflyingsheep.github.io/apple-touch-icon.png><link rel=mask-icon href=https://freeflyingsheep.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.85.0"><meta property="og:title" content="安装 WSL"><meta property="og:description" content="根据微软官方文档 Windows Subsystem for Linux Installation Guide for Windows 10 整理。"><meta property="og:type" content="article"><meta property="og:url" content="https://freeflyingsheep.github.io/posts/linux/wsl/"><meta property="og:image" content="https://freeflyingsheep.github.io/papermod-cover.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-09-21T00:00:00+00:00"><meta property="article:modified_time" content="2020-09-21T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://freeflyingsheep.github.io/papermod-cover.png"><meta name=twitter:title content="安装 WSL"><meta name=twitter:description content="根据微软官方文档 Windows Subsystem for Linux Installation Guide for Windows 10 整理。"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://freeflyingsheep.github.io/posts/"},{"@type":"ListItem","position":2,"name":"安装 WSL","item":"https://freeflyingsheep.github.io/posts/linux/wsl/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"安装 WSL","name":"安装 WSL","description":"根据微软官方文档 Windows Subsystem for Linux Installation Guide for Windows 10 整理。\n","keywords":["WSL"],"articleBody":"根据微软官方文档 Windows Subsystem for Linux Installation Guide for Windows 10 整理。\nWSL 1 和 WSL 2 的选择 两者的比较可以参考微软官方文档比较 WSL 1 和 WSL 2。\n个人推荐优先选择 WSL 2，若发现 WSL 2 和其他软件冲突，再回退到 WSL 1。\n启用 WSL 1 以管理员身份打开 PowerShell 并运行：\n1  dism.exe /online /enable-feature /featurename:Microsoft-Windows-Subsystem-Linux /all /norestart   重启计算机即可。\n启用 WSL 2 在启用 WSL 1的基础上，不要重启，而是以管理员身份打开 PowerShell 并运行：\n1  dism.exe /online /enable-feature /featurename:VirtualMachinePlatform /all /norestart   现在重启计算机。\n安装升级软件包 下载 WSL2 Linux kernel update package for x64 machines 并安装。\n将 WSL 2 设置为默认版本 以管理员的身份打开 PowerShell 并运行：\n1  wsl --set-default-version 2   从 WSL 2 回到 WSL 1 当 WSL 2 和其他软件冲突，需要关闭相关功能时，以管理员的身份打开 PowerShell 并运行：\n1 2  wsl --set-default-version 1 dism.exe /online /disable-feature /featurename:VirtualMachinePlatform   重启计算机。\n关闭 WSL 1 若开启了 WSL 2，先从 WSL 2 回到 WSL 1，跳过重启。\n以管理员的身份打开 PowerShell 并运行：\n1  dism.exe /online /disable-feature /featurename:Microsoft-Windows-Subsystem-Linux   现在重启计算机。\n安装 Linux 发行版 在应用商店选择想要安装的发行版即可。个人推荐在 WSL 1 下使用 Debian，在 WSL 2 下使用 Ubuntu 或者 Debian。\n指定发行版使用 WSL1 或 WSL2 查看所有安装的发行版，以管理员的身份打开 PowerShell 并运行：\n1  wsl --list -v   举个例子，若需要修改发行版 Debian 使用 WSL 1，运行以下指令：\n1  wsl --set-version Debian 1   安装 Windows Terminal 在应用商店选择安装 Windows Terminal。\n若想把 WSL 设为默认启动的终端，将 defaultProfile 设置为 WSL 的 guid，默认为 PowerShell。\n如果要指定终端启动时的大小，在 defaultProfile 之后加入如下配置（配置文件提供的注释已经很友好了）：\n1 2 3 4  // You can add more global application settings here. // To learn more about global settings, visit https://aka.ms/terminal-global-settings \"initialCols\": 80, \"initialRows\": 24,   在 profiles 的 defaults 中加入通用的配置，如：\n1 2 3 4  // Put settings here that you want to apply to all profiles. \"fontFace\": \"Jetbrains Mono\", \"fontSize\": 14, \"colorScheme\": \"idleToes\"   若使用自定义主题（如上面的 idleToes），需要在 schemes 中加入与 colorScheme 对应的颜色主题配置：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25  // Add custom color schemes to this array. // To learn more about color schemes, visit https://aka.ms/terminal-color-schemes \"schemes\": [ { \"name\": \"idleToes\", \"black\": \"#323232\", \"red\": \"#d25252\", \"green\": \"#7fe173\", \"yellow\": \"#ffc66d\", \"blue\": \"#4099ff\", \"purple\": \"#f680ff\", \"cyan\": \"#bed6ff\", \"white\": \"#eeeeec\", \"brightBlack\": \"#535353\", \"brightRed\": \"#f07070\", \"brightGreen\": \"#9dff91\", \"brightYellow\": \"#ffe48b\", \"brightBlue\": \"#5eb7f7\", \"brightPurple\": \"#ff9dff\", \"brightCyan\": \"#dcf4ff\", \"brightWhite\": \"#ffffff\", \"background\": \"#323232\", \"foreground\": \"#ffffff\" } ]   更多颜色主题可以参考 https://windowsterminalthemes.dev/。\n如果希望打开终端时路径是家目录，下面介绍两种常见的方式。\n第一种方法是很多博客介绍的，将 WSL 对应的 source 改为 commandline，并添加 startingDirectory，以 Ubuntu 20.04 为例，本人的家目录是 /home/chris，修改配置如下：\n1 2 3  // \"source\": \"Windows.Terminal.Wsl\" \"commandline\": \"ubuntu2004\", \"startingDirectory\": \"/home/chris\"   第二种方法是官方文档里介绍的，只需要添加 startingDirectory 选项，以 Debian 为例，修改配置如下：\n1 2  \"source\": \"Windows.Terminal.Wsl\", \"startingDirectory\": \"//wsl$/debian\"   WSL2 和部分 VPN 冲突 使用 WSL2 时出现“参考的对象类型不支持尝试的操作”的提示，可能是因为开启了 VPN，解决方案如下：\n Thanks for the info.\nWe have reproduced this issue. Apparently, wsl.exe displays this error if Winsock LSP DLL gets loaded into its process.\nThe easiest solution is to use WSCSetApplicationCategory WinAPI call for wsl.exe to prevent this. Under the hood the call creates an entry for wsl.exe at HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\WinSock2\\Parameters\\AppId_Catalog This tells Windows not to load LSP DLLs into wsl.exe process.\nWe have a tool that can make this call: www.proxifier.com/tmp/Test20200228/NoLsp.exe\nPlease just run as admin with the full path to wsl.exe as the parameter: NoLsp.exe c:\\windows\\system32\\wsl.exe\nThis has fixed the problem in my case.\nPlease let me know how it works for you.\n 上述内容来源于 https://github.com/microsoft/WSL/issues/4177#issuecomment-597736482。\n","wordCount":"471","inLanguage":"zh-cn","datePublished":"2020-09-21T00:00:00Z","dateModified":"2020-09-21T00:00:00Z","author":{"@type":"Person","name":"FreeFlyingSheep"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://freeflyingsheep.github.io/posts/linux/wsl/"},"publisher":{"@type":"Organization","name":"FreeFlyingSheep 的小站","logo":{"@type":"ImageObject","url":"https://freeflyingsheep.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"&&document.body.classList.add('dark')</script><noscript><style type=text/css>#theme-toggle,.top-link{display:none}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://freeflyingsheep.github.io/ accesskey=h title="FreeFlyingSheep 的小站 (Alt + H)">FreeFlyingSheep 的小站</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://freeflyingsheep.github.io/archives title=Archive><span>Archive</span></a></li><li><a href=https://freeflyingsheep.github.io/categories title=Categories><span>Categories</span></a></li><li><a href=https://freeflyingsheep.github.io/series title=Series><span>Series</span></a></li><li><a href=https://freeflyingsheep.github.io/tags title=Tags><span>Tags</span></a></li><li><a href=https://freeflyingsheep.github.io/about title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://freeflyingsheep.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://freeflyingsheep.github.io/posts/>Posts</a></div><h1 class=post-title>安装 WSL</h1><div class=post-meta>September 21, 2020&nbsp;·&nbsp;3 min&nbsp;·&nbsp;FreeFlyingSheep</div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><div class=details>Table of Contents</div></summary><div class=inner><ul><li><a href=#wsl-1-%e5%92%8c-wsl-2-%e7%9a%84%e9%80%89%e6%8b%a9 aria-label="WSL 1 和 WSL 2 的选择">WSL 1 和 WSL 2 的选择</a></li><li><a href=#%e5%90%af%e7%94%a8-wsl-1 aria-label="启用 WSL 1">启用 WSL 1</a></li><li><a href=#%e5%90%af%e7%94%a8-wsl-2 aria-label="启用 WSL 2">启用 WSL 2</a></li><li><a href=#%e5%ae%89%e8%a3%85%e5%8d%87%e7%ba%a7%e8%bd%af%e4%bb%b6%e5%8c%85 aria-label=安装升级软件包>安装升级软件包</a></li><li><a href=#%e5%b0%86-wsl-2-%e8%ae%be%e7%bd%ae%e4%b8%ba%e9%bb%98%e8%ae%a4%e7%89%88%e6%9c%ac aria-label="将 WSL 2 设置为默认版本">将 WSL 2 设置为默认版本</a></li><li><a href=#%e4%bb%8e-wsl-2-%e5%9b%9e%e5%88%b0-wsl-1 aria-label="从 WSL 2 回到 WSL 1">从 WSL 2 回到 WSL 1</a></li><li><a href=#%e5%85%b3%e9%97%ad-wsl-1 aria-label="关闭 WSL 1">关闭 WSL 1</a></li><li><a href=#%e5%ae%89%e8%a3%85-linux-%e5%8f%91%e8%a1%8c%e7%89%88 aria-label="安装 Linux 发行版">安装 Linux 发行版</a></li><li><a href=#%e6%8c%87%e5%ae%9a%e5%8f%91%e8%a1%8c%e7%89%88%e4%bd%bf%e7%94%a8-wsl1-%e6%88%96-wsl2 aria-label="指定发行版使用 WSL1 或 WSL2">指定发行版使用 WSL1 或 WSL2</a></li><li><a href=#%e5%ae%89%e8%a3%85-windows-terminal aria-label="安装 Windows Terminal">安装 Windows Terminal</a></li><li><a href=#wsl2-%e5%92%8c%e9%83%a8%e5%88%86-vpn-%e5%86%b2%e7%aa%81 aria-label="WSL2 和部分 VPN 冲突">WSL2 和部分 VPN 冲突</a></li></ul></div></details></div><div class=post-content><p>根据微软官方文档 <a href=https://docs.microsoft.com/en-us/windows/wsl/install-win10>Windows Subsystem for Linux Installation Guide for Windows 10</a> 整理。</p><h2 id=wsl-1-和-wsl-2-的选择>WSL 1 和 WSL 2 的选择<a hidden class=anchor aria-hidden=true href=#wsl-1-和-wsl-2-的选择>#</a></h2><p>两者的比较可以参考微软官方文档<a href=https://docs.microsoft.com/zh-cn/windows/wsl/compare-versions>比较 WSL 1 和 WSL 2</a>。</p><p>个人推荐优先选择 WSL 2，若发现 WSL 2 和其他软件冲突，再回退到 WSL 1。</p><h2 id=启用-wsl-1>启用 WSL 1<a hidden class=anchor aria-hidden=true href=#启用-wsl-1>#</a></h2><p>以管理员身份打开 PowerShell 并运行：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell>dism.exe /online /enable-feature /featurename<span style=color:#960050;background-color:#1e0010>:</span>Microsoft-Windows-Subsystem-Linux /all /norestart
</code></pre></td></tr></table></div></div><p>重启计算机即可。</p><h2 id=启用-wsl-2>启用 WSL 2<a hidden class=anchor aria-hidden=true href=#启用-wsl-2>#</a></h2><p>在<a href=#%E5%90%AF%E7%94%A8-wsl-1>启用 WSL 1</a>的基础上，不要重启，而是以管理员身份打开 PowerShell 并运行：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell>dism.exe /online /enable-feature /featurename<span style=color:#960050;background-color:#1e0010>:</span>VirtualMachinePlatform /all /norestart
</code></pre></td></tr></table></div></div><p>现在重启计算机。</p><h2 id=安装升级软件包>安装升级软件包<a hidden class=anchor aria-hidden=true href=#安装升级软件包>#</a></h2><p>下载 <a href=https://wslstorestorage.blob.core.windows.net/wslblob/wsl_update_x64.msi>WSL2 Linux kernel update package for x64 machines</a> 并安装。</p><h2 id=将-wsl-2-设置为默认版本>将 WSL 2 设置为默认版本<a hidden class=anchor aria-hidden=true href=#将-wsl-2-设置为默认版本>#</a></h2><p>以管理员的身份打开 PowerShell 并运行：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell>wsl --set-default-version 2
</code></pre></td></tr></table></div></div><h2 id=从-wsl-2-回到-wsl-1>从 WSL 2 回到 WSL 1<a hidden class=anchor aria-hidden=true href=#从-wsl-2-回到-wsl-1>#</a></h2><p>当 WSL 2 和其他软件冲突，需要关闭相关功能时，以管理员的身份打开 PowerShell 并运行：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell>wsl --set-default-version 1
dism.exe /online /disable-feature /featurename<span style=color:#960050;background-color:#1e0010>:</span>VirtualMachinePlatform
</code></pre></td></tr></table></div></div><p>重启计算机。</p><h2 id=关闭-wsl-1>关闭 WSL 1<a hidden class=anchor aria-hidden=true href=#关闭-wsl-1>#</a></h2><p>若开启了 WSL 2，先<a href=#%E4%BB%8E-wsl-2-%E5%9B%9E%E5%88%B0-wsl-1>从 WSL 2 回到 WSL 1</a>，跳过重启。</p><p>以管理员的身份打开 PowerShell 并运行：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell>dism.exe /online /disable-feature /featurename<span style=color:#960050;background-color:#1e0010>:</span>Microsoft-Windows-Subsystem-Linux
</code></pre></td></tr></table></div></div><p>现在重启计算机。</p><h2 id=安装-linux-发行版>安装 Linux 发行版<a hidden class=anchor aria-hidden=true href=#安装-linux-发行版>#</a></h2><p>在应用商店选择想要安装的发行版即可。个人推荐在 WSL 1 下使用 Debian，在 WSL 2 下使用 Ubuntu 或者 Debian。</p><h2 id=指定发行版使用-wsl1-或-wsl2>指定发行版使用 WSL1 或 WSL2<a hidden class=anchor aria-hidden=true href=#指定发行版使用-wsl1-或-wsl2>#</a></h2><p>查看所有安装的发行版，以管理员的身份打开 PowerShell 并运行：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell>wsl --list -v
</code></pre></td></tr></table></div></div><p>举个例子，若需要修改发行版 Debian 使用 WSL 1，运行以下指令：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell>wsl --set-version Debian 1
</code></pre></td></tr></table></div></div><h2 id=安装-windows-terminal>安装 Windows Terminal<a hidden class=anchor aria-hidden=true href=#安装-windows-terminal>#</a></h2><p>在应用商店选择安装 Windows Terminal。</p><p>若想把 WSL 设为默认启动的终端，将 <code>defaultProfile</code> 设置为 WSL 的 <code>guid</code>，默认为 PowerShell。</p><p>如果要指定终端启动时的大小，在 <code>defaultProfile</code> 之后加入如下配置（配置文件提供的注释已经很友好了）：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=color:#960050;background-color:#1e0010>//</span> <span style=color:#960050;background-color:#1e0010>You</span> <span style=color:#960050;background-color:#1e0010>can</span> <span style=color:#960050;background-color:#1e0010>add</span> <span style=color:#960050;background-color:#1e0010>more</span> <span style=color:#960050;background-color:#1e0010>global</span> <span style=color:#960050;background-color:#1e0010>application</span> <span style=color:#960050;background-color:#1e0010>settings</span> <span style=color:#960050;background-color:#1e0010>here.</span>
<span style=color:#960050;background-color:#1e0010>//</span> <span style=color:#960050;background-color:#1e0010>To</span> <span style=color:#960050;background-color:#1e0010>learn</span> <span style=color:#960050;background-color:#1e0010>more</span> <span style=color:#960050;background-color:#1e0010>about</span> <span style=color:#960050;background-color:#1e0010>global</span> <span style=color:#960050;background-color:#1e0010>settings,</span> <span style=color:#960050;background-color:#1e0010>visit</span> <span style=color:#960050;background-color:#1e0010>https://aka.ms/terminal-global-settings</span>
<span style=color:#e6db74>&#34;initialCols&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#ae81ff>80</span><span style=color:#960050;background-color:#1e0010>,</span>
<span style=color:#e6db74>&#34;initialRows&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#ae81ff>24</span><span style=color:#960050;background-color:#1e0010>,</span>
</code></pre></td></tr></table></div></div><p>在 <code>profiles</code> 的 <code>defaults</code> 中加入通用的配置，如：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=color:#960050;background-color:#1e0010>//</span> <span style=color:#960050;background-color:#1e0010>Put</span> <span style=color:#960050;background-color:#1e0010>settings</span> <span style=color:#960050;background-color:#1e0010>here</span> <span style=color:#960050;background-color:#1e0010>that</span> <span style=color:#960050;background-color:#1e0010>you</span> <span style=color:#960050;background-color:#1e0010>want</span> <span style=color:#960050;background-color:#1e0010>to</span> <span style=color:#960050;background-color:#1e0010>apply</span> <span style=color:#960050;background-color:#1e0010>to</span> <span style=color:#960050;background-color:#1e0010>all</span> <span style=color:#960050;background-color:#1e0010>profiles.</span>
<span style=color:#e6db74>&#34;fontFace&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#e6db74>&#34;Jetbrains Mono&#34;</span><span style=color:#960050;background-color:#1e0010>,</span>
<span style=color:#e6db74>&#34;fontSize&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#ae81ff>14</span><span style=color:#960050;background-color:#1e0010>,</span>
<span style=color:#e6db74>&#34;colorScheme&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#e6db74>&#34;idleToes&#34;</span>
</code></pre></td></tr></table></div></div><p>若使用自定义主题（如上面的 <code>idleToes</code>），需要在 <code>schemes</code> 中加入与 <code>colorScheme</code> 对应的颜色主题配置：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=color:#960050;background-color:#1e0010>//</span> <span style=color:#960050;background-color:#1e0010>Add</span> <span style=color:#960050;background-color:#1e0010>custom</span> <span style=color:#960050;background-color:#1e0010>color</span> <span style=color:#960050;background-color:#1e0010>schemes</span> <span style=color:#960050;background-color:#1e0010>to</span> <span style=color:#960050;background-color:#1e0010>this</span> <span style=color:#960050;background-color:#1e0010>array.</span>
<span style=color:#960050;background-color:#1e0010>//</span> <span style=color:#960050;background-color:#1e0010>To</span> <span style=color:#960050;background-color:#1e0010>learn</span> <span style=color:#960050;background-color:#1e0010>more</span> <span style=color:#960050;background-color:#1e0010>about</span> <span style=color:#960050;background-color:#1e0010>color</span> <span style=color:#960050;background-color:#1e0010>schemes,</span> <span style=color:#960050;background-color:#1e0010>visit</span> <span style=color:#960050;background-color:#1e0010>https://aka.ms/terminal-color-schemes</span>
<span style=color:#e6db74>&#34;schemes&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> [
    {
        <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;idleToes&#34;</span>,
        <span style=color:#f92672>&#34;black&#34;</span>: <span style=color:#e6db74>&#34;#323232&#34;</span>,
        <span style=color:#f92672>&#34;red&#34;</span>: <span style=color:#e6db74>&#34;#d25252&#34;</span>,
        <span style=color:#f92672>&#34;green&#34;</span>: <span style=color:#e6db74>&#34;#7fe173&#34;</span>,
        <span style=color:#f92672>&#34;yellow&#34;</span>: <span style=color:#e6db74>&#34;#ffc66d&#34;</span>,
        <span style=color:#f92672>&#34;blue&#34;</span>: <span style=color:#e6db74>&#34;#4099ff&#34;</span>,
        <span style=color:#f92672>&#34;purple&#34;</span>: <span style=color:#e6db74>&#34;#f680ff&#34;</span>,
        <span style=color:#f92672>&#34;cyan&#34;</span>: <span style=color:#e6db74>&#34;#bed6ff&#34;</span>,
        <span style=color:#f92672>&#34;white&#34;</span>: <span style=color:#e6db74>&#34;#eeeeec&#34;</span>,
        <span style=color:#f92672>&#34;brightBlack&#34;</span>: <span style=color:#e6db74>&#34;#535353&#34;</span>,
        <span style=color:#f92672>&#34;brightRed&#34;</span>: <span style=color:#e6db74>&#34;#f07070&#34;</span>,
        <span style=color:#f92672>&#34;brightGreen&#34;</span>: <span style=color:#e6db74>&#34;#9dff91&#34;</span>,
        <span style=color:#f92672>&#34;brightYellow&#34;</span>: <span style=color:#e6db74>&#34;#ffe48b&#34;</span>,
        <span style=color:#f92672>&#34;brightBlue&#34;</span>: <span style=color:#e6db74>&#34;#5eb7f7&#34;</span>,
        <span style=color:#f92672>&#34;brightPurple&#34;</span>: <span style=color:#e6db74>&#34;#ff9dff&#34;</span>,
        <span style=color:#f92672>&#34;brightCyan&#34;</span>: <span style=color:#e6db74>&#34;#dcf4ff&#34;</span>,
        <span style=color:#f92672>&#34;brightWhite&#34;</span>: <span style=color:#e6db74>&#34;#ffffff&#34;</span>,
        <span style=color:#f92672>&#34;background&#34;</span>: <span style=color:#e6db74>&#34;#323232&#34;</span>,
        <span style=color:#f92672>&#34;foreground&#34;</span>: <span style=color:#e6db74>&#34;#ffffff&#34;</span>
    }
]
</code></pre></td></tr></table></div></div><p>更多颜色主题可以参考 <a href=https://windowsterminalthemes.dev/>https://windowsterminalthemes.dev/</a>。</p><p>如果希望打开终端时路径是家目录，下面介绍两种常见的方式。</p><p>第一种方法是很多博客介绍的，将 WSL 对应的 <code>source</code> 改为 <code>commandline</code>，并添加 <code>startingDirectory</code>，以 Ubuntu 20.04 为例，本人的家目录是 <code>/home/chris</code>，修改配置如下：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=color:#960050;background-color:#1e0010>//</span> <span style=color:#e6db74>&#34;source&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#e6db74>&#34;Windows.Terminal.Wsl&#34;</span>
<span style=color:#e6db74>&#34;commandline&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#e6db74>&#34;ubuntu2004&#34;</span><span style=color:#960050;background-color:#1e0010>,</span>
<span style=color:#e6db74>&#34;startingDirectory&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#e6db74>&#34;/home/chris&#34;</span>
</code></pre></td></tr></table></div></div><p>第二种方法是官方文档里介绍的，只需要添加 <code>startingDirectory</code> 选项，以 Debian 为例，修改配置如下：</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=color:#e6db74>&#34;source&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#e6db74>&#34;Windows.Terminal.Wsl&#34;</span><span style=color:#960050;background-color:#1e0010>,</span>
<span style=color:#e6db74>&#34;startingDirectory&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#e6db74>&#34;//wsl$/debian&#34;</span>
</code></pre></td></tr></table></div></div><h2 id=wsl2-和部分-vpn-冲突>WSL2 和部分 VPN 冲突<a hidden class=anchor aria-hidden=true href=#wsl2-和部分-vpn-冲突>#</a></h2><p>使用 WSL2 时出现“参考的对象类型不支持尝试的操作”的提示，可能是因为开启了 VPN，解决方案如下：</p><blockquote><p>Thanks for the info.</p><p>We have reproduced this issue.
Apparently, wsl.exe displays this error if Winsock LSP DLL gets loaded into its process.</p><p>The easiest solution is to use WSCSetApplicationCategory WinAPI call for wsl.exe to prevent >this.
Under the hood the call creates an entry for wsl.exe at >HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\WinSock2\Parameters\AppId_Catalog
This tells Windows not to load LSP DLLs into wsl.exe process.</p><p>We have a tool that can make this call:
<a href=http://www.proxifier.com/tmp/Test20200228/NoLsp.exe>www.proxifier.com/tmp/Test20200228/NoLsp.exe</a></p><p>Please just run as admin with the full path to wsl.exe as the parameter:
NoLsp.exe c:\windows\system32\wsl.exe</p><p>This has fixed the problem in my case.</p><p>Please let me know how it works for you.</p></blockquote><p>上述内容来源于 <a href=https://github.com/microsoft/WSL/issues/4177#issuecomment-597736482>https://github.com/microsoft/WSL/issues/4177#issuecomment-597736482</a>。</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://freeflyingsheep.github.io/tags/wsl/>WSL</a></li></ul><nav class=paginav><a class=prev href=https://freeflyingsheep.github.io/posts/tips/zsh/><span class=title>«</span><br><span>使用 Zsh</span></a>
<a class=next href=https://freeflyingsheep.github.io/posts/linux/lfs/><span class=title>»</span><br><span>构建 LFS 系统</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2021 <a href=https://freeflyingsheep.github.io/>FreeFlyingSheep 的小站</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script>let menu=document.getElementById('menu');menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script><script>document.querySelectorAll('pre > code').forEach(b=>{const c=b.parentNode.parentNode,a=document.createElement('button');a.classList.add('copy-code'),a.innerText='copy';function d(){a.innerText='copied!',setTimeout(()=>{a.innerText='copy'},2e3)}a.addEventListener('click',e=>{if('clipboard'in navigator){navigator.clipboard.writeText(b.textContent),d();return}const a=document.createRange();a.selectNodeContents(b);const c=window.getSelection();c.removeAllRanges(),c.addRange(a);try{document.execCommand('copy'),d()}catch(a){}c.removeRange(a)}),c.classList.contains("highlight")?c.appendChild(a):c.parentNode.firstChild==c||(b.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?b.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(a):b.parentNode.appendChild(a))})</script></body></html>